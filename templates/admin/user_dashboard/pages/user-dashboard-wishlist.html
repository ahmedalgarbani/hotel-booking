{% extends "admin/user_dashboard/index.html" %}
{% load static %}
{% block section_title %}wishlist{% endblock section_title %}
{% block path_title %}wishlist{% endblock path_title %}

{% block content %}
<div class="dashboard-main-content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-12">
        <div class="form-box">
          <div class="form-title-wrap">
            <h3 class="title">قائمة الرغبات</h3>
            <p class="font-size-14">عرض {{ favourites|length }} من النتائج</p>
          </div>
          <div class="form-content pt-5 pb-0">
            <div class="row">
              {% for favourite in favourites %}
              <div class="col-lg-4 responsive-column">
                <div class="card-item">
                  <div class="card-img position-relative">
                    <a href="{% url 'home:hotel_detail' favourite.hotel.slug %}" class="d-block">
                      {% if favourite.hotel.profile_picture %}
                        <img src="{{ favourite.hotel.profile_picture.url }}" alt="{{ favourite.hotel.name }}" class="img-fluid" style="height:250px; object-fit:cover;" />
                      {% else %}
                        <img src="{% static 'images/default-hotel.jpg' %}" alt="default-hotel" class="img-fluid" />
                      {% endif %}
                    </a>

                    {% if favourite.hotel.is_best_seller %}
                    <span class="badge">الأكثر مبيعا</span>
                    {% endif %}

                    <div class="add-to-wishlist icon-element" data-bs-toggle="tooltip" data-placement="top" title="إزالة">
                      <a href="{% url 'customer:remove_favourite' favourite.id %}" class="remove-favourite-btn">
                        <i class="la la-heart text-danger"></i>
                      </a>
                    </div>
                  </div>
                  <div class="card-body">
                    <h3 class="card-title">
                      <a href="{% url 'home:hotel_detail' favourite.hotel.slug %}">{{ favourite.hotel.name }}</a>
                    </h3>
                    <p class="card-meta">{{ favourite.hotel.location.address }}</p>
                    <div class="card-rating">
                      <span class="badge text-white bg-success">{{ favourite.hotel.rating }}/5</span>
                      <span class="review__text">معدل</span>
                      <span class="rating__text">({{ favourite.hotel.reviews.count }} التعليقات)</span>
                    </div>
                    <div class="card-price d-flex align-items-center justify-content-between">
                      <p>
                        <span class="price__from">من عند</span>
                        <span class="price__num">${{ favourite.hotel.price_per_night }}</span>
                        <span class="price__text">لليلة الواحدة</span>
                      </p>
                      <a href="{% url 'home:hotel_detail' favourite.hotel.slug %}" class="btn-text">
                        انظر التفاصيل <i class="la la-angle-right"></i>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
              {% empty %}
              <div class="col-lg-12">
                <p class="text-center mt-4">لا توجد عناصر في قائمة الرغبات حتى الآن.</p>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="row">
      <div class="col-lg-12">
        <nav aria-label="Page navigation example">
          <ul class="pagination">
            <li class="page-item">
              <a class="page-link page-link-nav" href="#" aria-label="Previous">
                <span aria-hidden="true"><i class="la la-angle-left"></i></span>
                <span class="sr-only">Previous</span>
              </a>
            </li>
            <li class="page-item"><a class="page-link page-link-nav" href="#">1</a></li>
            <li class="page-item active">
              <a class="page-link page-link-nav" href="#">2 <span class="sr-only">(current)</span></a>
            </li>
            <li class="page-item"><a class="page-link page-link-nav" href="#">3</a></li>
            <li class="page-item">
              <a class="page-link page-link-nav" href="#" aria-label="Next">
                <span aria-hidden="true"><i class="la la-angle-right"></i></span>
                <span class="sr-only">Next</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div>

    <!-- Footer -->
    <div class="border-top mt-5"></div>
    <div class="row align-items-center">
      <div class="col-lg-7">
        <div class="copy-right padding-top-30px">
          <p class="copy__desc">
            &copy; Copyright TeamSoft 2025. Made with
            <span class="la la-heart"></span> by
            <a href="https://ahmed-div.netlify.app">TeamSoft</a>
          </p>
        </div>
      </div>
      <div class="col-lg-5">
        <div class="footer-social-box text-end padding-top-30px">
          <ul class="social-profile">
            <li><a href="#"><i class="lab la-facebook-f"></i></a></li>
            <li><a href="#"><i class="lab la-twitter"></i></a></li>
            <li><a href="#"><i class="lab la-instagram"></i></a></li>
            <li><a href="#"><i class="lab la-linkedin-in"></i></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block scripts %}
<script>
  document.querySelectorAll('.remove-favourite-btn').forEach(button => {
    button.addEventListener('click', function (e) {
      e.preventDefault();
      const url = this.getAttribute('href');

      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            alert('تم الحذف بنجاح');
            location.reload();
          } else {
            alert('فشل في الحذف');
          }
        })
        .catch(() => {
          alert('حدث خطأ أثناء الحذف');
        });
    });
  });
</script>
{% endblock %}
