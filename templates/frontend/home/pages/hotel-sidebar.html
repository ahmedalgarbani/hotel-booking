{% extends "frontend/layout/master.html" %}
{% load static %}
{% block content %}
<style>

  /* Default button styling */
.add-to-wishlist {
  color: #6c757d; /* grey by default */
  background-color: transparent;
  border: none;
  cursor: pointer;
  transition: background-color 0.3s, color 0.3s;
}

.add-to-wishlist .la-heart-o {
  color: #6c757d; /* grey heart */
}

.add-to-wishlist .la-heart {
  color:red; /* white heart when selected */

}

/* Blue button when added to wishlist */
.btn-blue {
  background-color: #007bff; /* blue background */
  color: block; /* white text */
}

.btn-blue .la-heart {
  color: red; /* white heart icon when selected */

}

.custom-checkbox {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
}
.custom-checkbox input[type="checkbox"] {
    margin-left: 8px;
}
.sidebar-review .ratings {
    margin-right: 0;
}
.sidebar-category .custom-checkbox {
    margin-bottom: 8px;
}

/* Estilos para tarjetas de hoteles de tamaño uniforme */
.card-item {
    height: 100%;
    display: flex;
    flex-direction: column;
    margin-bottom: 20px;
}

.card-item .card-img {
    position: relative;
    width: 100%;
    height: 220px; /* Altura fija para todas las imágenes */
    overflow: hidden;
}

.card-item .card-img img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Mantiene la proporción y cubre el área */
    object-position: center;
}

.card-item .card-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 20px;
}

.card-item .card-title {
    margin-top: 0;
    margin-bottom: 10px;
}

.card-item .card-price {
    margin-top: auto;
}

.responsive-column {
    margin-bottom: 20px;
}

</style>
    <!-- ================================
    START BREADCRUMB AREA
================================= -->
<section class="breadcrumb-area bread-bg-7">
  <div class="breadcrumb-wrap">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-6">
          <div class="breadcrumb-content">
            <div class="section-heading">
              <h2 class="sec__title text-white">الشريط الجانبي للفندق</h2>
            </div>
          </div>
          <!-- end breadcrumb-content -->
        </div>
        <!-- end col-lg-6 -->
        <div class="col-lg-6">
          <div class="breadcrumb-list text-end">
            <ul class="list-items">
              <li><a href="index.html">الصفحة الرئيسية</a></li>
              <li>الفندق</li>
              <li>الشريط الجانبي للفندق</li>
            </ul>
          </div>
          <!-- end breadcrumb-list -->
        </div>
        <!-- end col-lg-6 -->
      </div>
      <!-- end row -->
    </div>
    <!-- end container -->
  </div>
  <!-- end breadcrumb-wrap -->
  <div class="bread-svg-box">
    <svg
      class="bread-svg"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 100 10"
      preserveAspectRatio="none"
    >
      <polygon points="100 0 50 10 0 0 0 10 100 10"></polygon>
    </svg>
  </div>
  <!-- end bread-svg -->
</section>
<!-- end breadcrumb-area -->
<!-- ================================
END BREADCRUMB AREA
================================= -->

<!-- ================================
START CARD AREA
================================= -->
<section class="card-area section--padding">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="filter-wrap margin-bottom-30px">
          <div
            class="filter-top d-flex align-items-center justify-content-between pb-4"
          >
            <div>
              <h3 class="title font-size-24">تم العثور على {{hotels.count}} الفنادق</h3>
              <p class="font-size-14">
                <span class="me-1 pt-1">احجز بثقة: </span> لا توجد رسوم على
                حجز الفنادق
              </p>
            </div>
            <div class="layout-view d-flex align-items-center">
              <a
                href="hotel-grid.html"
                data-bs-toggle="tooltip"
                data-placement="top"
                title="عرض شبكي"
                class="active"
                ><i class="la la-th-large"></i
              ></a>
              <a
                href="javascript:;"
                data-bs-toggle="tooltip"
                data-placement="top"
                title="عرض القائمة"
                ><i class="la la-th-list"></i
              ></a>
            </div>
          </div>
        </div>
        <!-- end filter-wrap -->
      </div>
      <!-- end col-lg-12 -->
    </div>
    <!-- end row -->
    <div class="row">
      <div class="col-lg-8">
        <div class="row">
          {% for hotel in hotels %}
             <!-- end col-lg-6 -->
             <div class="col-lg-6 responsive-column">
              <div class="card-item">
                <div class="card-img">
                 {% if hotel.profile_picture %}
                 <a href="{{hotel.get_absolute_url}}" class="d-block">
                  <img src="{{hotel.profile_picture.url}}" alt="hotel-img" />
                </a>
                 {% endif %}


              
{% if hotel.best_seller %}
            <span class="badge " style="margin:20px 0 0 10px">الأكثر مبيعا</span>
            {% endif %}

                 <a class="add-to-wishlist icon-element {% if hotel.is_favorite %}btn-blue{% endif %}"
                 data-bs-toggle="tooltip"
                 data-placement="top"
                 data-hotel-id={{hotel.id}}
                 title="المرجعية">

                 <i class="la la-heart{% if hotel.is_favorite %} {% else %}-o{% endif %}"></i>
                 
              </a>
            

                </div>
                
                <div class="card-body">
                  <h3 class="card-title">
                    <a href="{{hotel.get_absolute_url}}">{{hotel.name}}</a>
                  </h3>
                  <h6 class="">
                    <p> عدد الحجوزات ({{hotel.booking_count}})</p>
                  </h6>
                  <p class="card-meta">{{hotel.location}},{{hotel.location.city.state}}</p>
                  <div class="card-rating">
                    {% if hotel.average_rating > 0 %}

                    <span class="badge text-white">{{hotel.average_rating}}/5</span>

                    {% else %}
                    <span class="badge text-white">0.0/5</span>

                    {% endif %}
                    <span class="review__text">معدل</span>
                    <span class="rating__text">({{hotel.review_count}} التعليقات)</span>
                  </div>
                  <div
                    class="card-price d-flex align-items-center justify-content-between"
                  >

                    <a href="{{hotel.get_absolute_url}}" class="btn-text"
                      >انظر التفاصيل<i class="la la-angle-right"></i
                    ></a>
                  </div>
                </div>
              </div>
              <!-- end card-item -->
            </div>
            <!-- end col-lg-6 -->
          {% endfor %}

        </div>
        <!-- end row -->
        <div class="row">
          <div class="col-lg-12">
            <div class="btn-box mt-3 text-center">
              <button type="button" class="theme-btn">
                <i class="la la-refresh me-1"></i>تحميل المزيد
              </button>
              <p class="font-size-13 pt-2">عرض 1 - 8 من {{hotels.count}} فنادق</p>
            </div>
            <!-- end btn-box -->
          </div>
          <!-- end col-lg-12 -->
        </div>
        <!-- end row -->
      </div>
      <!-- end col-lg-8 -->
      <div class="col-lg-4">
        <div class="sidebar mb-0">
          <div class="sidebar-widget">
            <h3 class="title stroke-shape">البحث عن الفنادق</h3>
            <div class="sidebar-widget-item">
              <div class="contact-form-action">
                <form action="" method="get">
                  <div class="input-box">
                    <label class="label-text">الوجهة / اسم الفندق</label>
                    <div class="form-group">
                      <span class="la la-map-marker form-icon"></span>
                      <input
                        class="form-control"
                        type="text"
                        name="search"
                        value="{{ search_query }}"
                        placeholder="الوجهة ، اسم الفندق"
                      />
                    </div>
                  </div>
                  <div class="sidebar-widget-item">
                    <div
                      class="qty-box mb-2 d-flex align-items-center justify-content-between"
                    >
                      <label class="font-size-16">غرف</label>
                      <div class="roomBtn d-flex align-items-center">
                        <div class="qtyDec" data-input="rooms"><i class="la la-minus"></i></div>
                        <input type="text" name="rooms" value="{{ rooms|default:'' }}" readonly />
                        <div class="qtyInc" data-input="rooms"><i class="la la-plus"></i></div>
                      </div>
                    </div>
                    <!-- end qty-box -->
                    <div
                      class="qty-box mb-2 d-flex align-items-center justify-content-between"
                    >
                      <label class="font-size-16">الاشخاص</label>
                      <div class="qtyBtn d-flex align-items-center">
                        <div class="qtyDec" data-input="persons"><i class="la la-minus"></i></div>
                        <input type="text" name="persons" value="{{ persons|default:'' }}" readonly />
                        <div class="qtyInc" data-input="persons"><i class="la la-plus"></i></div>
                      </div>
                    </div>
                    <!-- end qty-box -->
                    <div
                      class="qty-box mb-2 d-flex align-items-center justify-content-between"
                    >
                      <label class="font-size-16"
                        >الحد الاقصى للاشخاص</label
                      >
                      <div class="qtyBtn d-flex align-items-center">
                        <div class="qtyDec" data-input="max_persons"><i class="la la-minus"></i></div>
                        <input type="text" name="max_persons" value="{{ max_persons|default:'' }}" readonly />
                        <div class="qtyInc" data-input="max_persons"><i class="la la-plus"></i></div>
                      </div>
                    </div>
                    <!-- end qty-box -->
                  </div>
                  <!-- Price Range Section -->
                  <div class="sidebar-widget">
                    <h3 class="title stroke-shape">تصفية حسب السعر</h3>
                    <div class="sidebar-price-range">
                      <div class="main-search-input-item">
                        <div class="price-slider-amount padding-bottom-20px">
                          <label for="amount2" class="filter__label">السعر:</label>
                          <input type="text" id="amount2" class="amounts" readonly />
                          <input type="hidden" name="min_price" id="min_price" value="{{ min_price|default:0 }}" />
                          <input type="hidden" name="max_price" id="max_price" value="{{ max_price|default:1000 }}" />
                        </div>
                        <div id="slider-range2"></div>
                      </div>
                    </div>
                  </div>
                  <!-- End Price Range Section -->
                  <!-- Rating Filter Section -->
                    <div class="sidebar-widget">
                      <h3 class="title stroke-shape">تصفية حسب التصنيف</h3>
                      <div class="sidebar-review">
                        <div class="custom-checkbox">
                          <input type="checkbox" id="rating5" name="rating" value="5" {% if '5' in ratings %}checked{% endif %} />
                          <label for="rating5" class="ratings d-flex align-items-center">
                            <i class="la la-star"></i>
                            <i class="la la-star"></i>
                            <i class="la la-star"></i>
                            <i class="la la-star"></i>
                            <i class="la la-star"></i>
                          </label>
                        </div>
                        <div class="custom-checkbox">
                          <input type="checkbox" id="rating4" name="rating" value="4" {% if '4' in ratings %}checked{% endif %} />
                          <label for="rating4" class="ratings d-flex align-items-center">
                            <i class="la la-star"></i>
                            <i class="la la-star"></i>
                            <i class="la la-star"></i>
                            <i class="la la-star"></i>
                            <i class="la la-star text-gray"></i>
                          </label>
                        </div>
                        <div class="custom-checkbox">
                          <input type="checkbox" id="rating3" name="rating" value="3" {% if '3' in ratings %}checked{% endif %} />
                          <label for="rating3" class="ratings d-flex align-items-center">
                            <i class="la la-star"></i>
                            <i class="la la-star"></i>
                            <i class="la la-star"></i>
                            <i class="la la-star text-gray"></i>
                            <i class="la la-star text-gray"></i>
                          </label>
                        </div>
                        <div class="custom-checkbox">
                          <input type="checkbox" id="rating2" name="rating" value="2" {% if '2' in ratings %}checked{% endif %} />
                          <label for="rating2" class="ratings d-flex align-items-center">
                            <i class="la la-star"></i>
                            <i class="la la-star"></i>
                            <i class="la la-star text-gray"></i>
                            <i class="la la-star text-gray"></i>
                            <i class="la la-star text-gray"></i>
                          </label>
                        </div>
                        <div class="custom-checkbox">
                          <input type="checkbox" id="rating1" name="rating" value="1" {% if '1' in ratings %}checked{% endif %} />
                          <label for="rating1" class="ratings d-flex align-items-center">
                            <i class="la la-star"></i>
                            <i class="la la-star text-gray"></i>
                            <i class="la la-star text-gray"></i>
                            <i class="la la-star text-gray"></i>
                            <i class="la la-star text-gray"></i>
                          </label>
                        </div>
                      </div>
                    </div>
                    <!-- End Rating Filter Section -->
                    <!-- Hotel Services Filter Section -->
                    <div class="sidebar-widget">
                      <h3 class="title stroke-shape">مرافق</h3>
                      <div class="sidebar-category">
                        {% for service in all_services %}
                        <div class="custom-checkbox">
                          <input type="checkbox" id="service_{{ service.id }}" name="services" value="{{ service.id }}"
                            {% if service.id|stringformat:"i" in selected_services %}checked{% endif %} />
                          <label for="service_{{ service.id }}">
                            {{ service.name }}
                          </label>
                        </div>
                        {% endfor %}
                      </div>
                    </div>
                    <!-- End Hotel Services Filter Section -->
                  <div class="btn-box pt-2">
                    <button type="submit" class="theme-btn">
                      <i class="la la-refresh me-1"></i>ابحث الآن
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <!-- end sidebar-widget -->
        </div>
        <!-- end sidebar -->
      </div>
      <!-- end col-lg-4 -->
    </div>
    <!-- end row -->
  </div>
  <!-- end container -->
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle quantity increment/decrement
    const handleQuantityChange = (input, isIncrement) => {
        const currentValue = parseInt(input.value) || 0;
        const newValue = isIncrement ? currentValue + 1 : Math.max(0, currentValue - 1);
        input.value = newValue;
    };

    // Add event listeners to all quantity buttons
    document.querySelectorAll('.qtyInc, .qtyDec').forEach(button => {
        button.addEventListener('click', function() {
            const inputName = this.getAttribute('data-input');
            const input = document.querySelector(`input[name="${inputName}"]`);
            if (input) {
                handleQuantityChange(input, this.classList.contains('qtyInc'));
            }
        });
    });

    // Initialize price range slider
    if ($.fn.slider) {
        $("#slider-range2").slider({
            range: true,
            min: 0,
            max: 1000,
            values: [
                parseInt($("#min_price").val()) || 0,
                parseInt($("#max_price").val()) || 1000
            ],
            slide: function(event, ui) {
                $("#amount2").val(ui.values[0] + " - " + ui.values[1] + " ريال");
                $("#min_price").val(ui.values[0]);
                $("#max_price").val(ui.values[1]);
            }
        });

        // Set initial display value
        $("#amount2").val(
            $("#slider-range2").slider("values", 0) +
            " - " +
            $("#slider-range2").slider("values", 1) +
            " ريال"
        );
    }
});
</script>
<script>
document.querySelectorAll('.add-to-wishlist').forEach(function(button) {
   button.addEventListener('click', function() {
       var hotelId = this.getAttribute('data-hotel-id');

       fetch("{% url 'customer:add_to_favorites' %}", {
           method: 'POST',
           headers: {
               'Content-Type': 'application/json',
               'X-CSRFToken': '{{ csrf_token }}',
           },
           body: JSON.stringify({
               'hotel_id': hotelId,
           }),
       })
       .then(response => response.json())
       .then(data => {
           if (data.status === 'success') {
               var icon = button.querySelector('i');

               // تحقق من وجود الكلاس btn-blue
               if (!button.classList.contains('btn-blue')) {
                   button.classList.add('btn-blue');
                   icon.classList.remove('la-heart-o');
                   icon.classList.add('la-heart');
               } else {
                   button.classList.remove('btn-blue');
                   icon.classList.remove('la-heart');
                   icon.classList.add('la-heart-o');
               }
           }
       })
       .catch(error => {
           console.error('Error:', error);
       });
   });
});

			</script>
{% endblock content %}