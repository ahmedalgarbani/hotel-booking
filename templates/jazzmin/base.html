{% load static %}
{% block top_navbar_right %}
    {{ block.super }}

    {% with notifications=notifications %}
    <li class="nav-item dropdown">
        <a class="nav-link" data-toggle="dropdown" href="#" title="الإشعارات">
            <i class="fas fa-bell"></i>
            {% if unread_notifications_count > 0 %}
                <span class="badge badge-warning navbar-badge">{{ unread_notifications_count }}</span>
            {% endif %}
        </a>
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
            <div class="dropdown-item dropdown-header d-flex justify-content-between">
                <span>{{ unread_notifications_count }} إشعارات غير مقروءة</span>
                {% if unread_notifications_count > 0 %}
                <a href="#" class="text-sm mark-all-read">تحديد الكل كمقروء</a>
                {% endif %}
            </div>
            {% for notification in notifications %}
                {% if notification.status == '0' %}
                <a href="{% url 'notifications:handle_notification' notification.id %}" class="dropdown-item unread" data-notification-id="{{ notification.id }}">
                    <i class="fas fa-{{ notification.get_icon_class }} mr-2"></i> {{ notification.title }}
                    <span class="float-right text-muted text-sm">{{ notification.send_time|timesince }}</span>
                    <p class="text-sm text-muted">{{ notification.message|truncatechars:50 }}</p>
                </a>
                <div class="dropdown-divider"></div>
                {% endif %}
            {% empty %}
                <a href="#" class="dropdown-item">
                    <i class="fas fa-info-circle mr-2"></i> لا توجد إشعارات جديدة
                </a>
            {% endfor %}
            <a href="{% url 'admin:notifications_notifications_changelist' %}" class="dropdown-item dropdown-footer">عرض كل الإشعارات</a>
        </div>
    </li>
    {% endwith %}

    <!-- إضافة ملفات JavaScript للإشعارات -->
    <script src="{% static 'js/notifications.js' %}"></script>
    <script src="{% static 'admin/js/jazzmin-sidebar-notifications.js' %}"></script>

    <!-- إضافة عدد الإشعارات كمتغير عام -->
    {% if unread_notifications_count %}
    <span id="unread-notifications-count" style="display: none;">{{ unread_notifications_count }}</span>
    <script>
        // تعريف متغير عام لعدد الإشعارات غير المقروءة
        window.unreadNotificationsCount = {{ unread_notifications_count }};
    </script>
    {% endif %}

    <style>
        /* تنسيق الإشعارات غير المقروءة */
        .dropdown-item.unread {
            background-color: rgba(255, 193, 7, 0.1);
            font-weight: bold;
        }

        /* تنسيق زر تحديد الكل كمقروء */
        .mark-all-read {
            color: #007bff;
            cursor: pointer;
        }

        .mark-all-read:hover {
            text-decoration: underline;
        }
    </style>
{% endblock %}
